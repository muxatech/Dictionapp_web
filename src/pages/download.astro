---
import Layout from '../layouts/Layout.astro';
---
<Layout title="Dictionapp - Downloads">
  <p>Redirecting…</p>

  <script type="module">
    (() => {
      const ua = navigator.userAgent;
      const isIOS = /iPhone|iPad|iPod/i.test(ua);
      const isAndroid = /Android/i.test(ua);

      const iosLink =
        "https://apps.apple.com/es/app/dictionapp/id6754826488";

      const androidBaseLink =
        "https://play.google.com/store/apps/details?id=com.studiomuxatech.dictionapp";

      const params = new URLSearchParams(window.location.search);
      const affiliateCode = params.get("r");

      // iOS → siempre App Store
      if (isIOS) {
        window.location.replace(iosLink);
        return;
      }

      // Android
      if (isAndroid) {
        if (affiliateCode) {
          const encoded = encodeURIComponent(affiliateCode);
          const androidLinkWithReferrer =
            `${androidBaseLink}&referrer=r%3D${encoded}`;

          window.location.replace(androidLinkWithReferrer);
        } else {
          window.location.replace(androidBaseLink);
        }
        return;
      }

      // Fallback (desktop, otros)
      window.location.replace(androidBaseLink);
    })();
  </script>
</Layout>